jQuery(document).ready(function(e){let t;function o(e,t=1){let o=0,a=0,n=0;return 4===e.length?(o=parseInt(e[1]+e[1],16),a=parseInt(e[2]+e[2],16),n=parseInt(e[3]+e[3],16)):7===e.length&&(o=parseInt(e.slice(1,3),16),a=parseInt(e.slice(3,5),16),n=parseInt(e.slice(5,7),16)),`rgba(${o}, ${a}, ${n}, ${t})`}function a(){console.log("Updating overlay preview...");const t=e("#kwp_modal_button_color").val(),a=e("#kwp_modal_button_text").val(),n=e("#kwp_modal_callout").val(),l=e("#kwp_modal_gradient_direction").val()||"to right",i=e("#kwp_modal_extra").val(),r=parseFloat(e("#kwp_modal_gradient_opacity").val())||.6,p=o(e("#kwp_gradient_primary").val()||"#4a044e",r),d=o(e("#kwp_gradient_secondary").val()||"#111827",r),s=e("#kwp_modal_supporting").val(),u=e("#kwp_modal_text_color").val()||"#fff",c="1"===e("#kwp_modal_text_shadow").val().toString()?"kwp-modal-text-shadow":"",m=e("#title").val(),_=`linear-gradient(${l}, ${p}, ${d})`;e("#kwp-image-overlay").css("background",_),e("#kwp_modal_title-preview").html(m||"Your Title Here"),e("#kwp_modal_callout-preview").html(n||"Your Callout Here"),e("#kwp_modal_supporting-preview").html(s||"Supporting text goes here."),e("#kwp_modal_extra-preview").html(i||"Additional information can be placed here."),e("#kwp-modal-text-preview").removeClass().addClass(`kwp-modal-text-preview ${u} ${c}`),a&&t&&(console.log("Updating button preview..."),e("#kwp_modal_button-preview > .kwp-button").text(a||"Go Â»").removeClass().addClass("kwp-button "+t))}function n(){const e=document.getElementById("_kwp_modal_end_time");return e.value?new Date(e.value):null}function l(){return function(){const e=document.getElementById("_kwp_modal_start_time");return new Date(e.value)}()<=new Date&&(!n()||n()>new Date)}e(".button-color-field").wpColorPicker(),e("#kwp_modal_bg_image_button").on("click",function(o){o.preventDefault(),t||(t=wp.media({title:"Select Background Image",button:{text:"Use this image"},multiple:!1}),t.on("select",function(){const o=t.state().get("selection").first().toJSON();e("#kwp_modal_bg_image").val(o.id),e("#kwp_modal_bg_image_preview").attr("src",o.url)})),t.open()}),e(".color-field").wpColorPicker({palettes:["#111827","#fff","#4a044e","#b8860b","#006980"],change:function(){setTimeout(a,0)}}),e("#kwp-modal-metabox-form").find("input, textarea, select").on("keyup change input",function(){setTimeout(a,0)}),e("#title").on("keyup change input",function(){setTimeout(a,0)}),a();let i=l();e("#kwp_modal_start_time, #kwp_modal_end_time").on("change",function(){i=l()});const r=e("#publish");if("Update"===r.val()){const t=e("<div>",{text:"Clicking Update will force this popup to (re)appear for all users.",css:{position:"absolute",background:"#ffc",border:"1px solid #ccc",padding:"8px","border-radius":"4px","box-shadow":"0 0 5px rgba(0,0,0,0.2)","z-index":9999,"max-width":"250px",display:"none","font-size":"13px",color:"#23282d"}}).appendTo("body");r.on("mouseenter",function(){if(!i)return;const e=r.offset();t.css({top:e.top-t.outerHeight()-6,left:e.left+r.outerWidth()/2-t.outerWidth()/2,display:"block"})}),r.on("mouseleave",function(){t.hide()})}e("#kwp_modal_suppress").on("input",function(){this.validity.rangeUnderflow?this.setCustomValidity("A minimum value of 1 is required, lest the modal appear on every page load."):this.setCustomValidity("")})});